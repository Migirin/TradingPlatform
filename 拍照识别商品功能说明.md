# 拍照识别商品功能

## 功能简介

实现了拍照识别商品功能，用户可以通过拍照识别物体（如耳机、笔记本电脑等），系统会自动推荐相关的商品。

## 核心功能

### 1. 拍照功能
- 使用 CameraX 实现相机预览和拍照
- 支持后置摄像头
- 自动处理图片旋转
- 权限管理（相机权限）

### 2. 图像识别
- 使用 Google ML Kit 的 Image Labeling 进行物体识别
- 识别多种物体类型（耳机、电脑、书籍、服装等）
- 显示识别置信度
- 支持多标签识别

### 3. 商品推荐
- 根据识别结果智能推荐相关商品
- 匹配算法考虑：
  - 商品类别匹配（40分）
  - 标题关键词匹配（50分）
  - 描述匹配（10分）
  - 置信度加权
- 返回匹配分数最高的前10个商品
- 显示匹配原因

### 4. 识别结果展示
- 显示拍摄的图片
- 显示识别结果（物体名称、类别、置信度）
- 显示推荐商品列表
- 点击商品可查看详情

## 使用流程

1. **进入拍照界面**
   - 在商品列表页点击"📷 拍照识别"按钮
   - 系统会请求相机权限（首次使用）

2. **拍照**
   - 对准要识别的物体
   - 点击拍照按钮（📷）
   - 系统自动识别图片中的物体

3. **查看识别结果**
   - 显示识别出的物体（如"耳机"、"笔记本电脑"等）
   - 显示识别置信度
   - 显示对应的商品类别

4. **查看推荐商品**
   - 系统根据识别结果推荐相关商品
   - 显示匹配分数和匹配原因
   - 点击商品可查看详情

## 技术实现

### 依赖库
- **ML Kit Image Labeling**: 用于图像识别
- **CameraX**: 用于相机功能
- **Compose**: UI界面

### 核心组件

#### 1. ImageRecognitionService
- 使用 ML Kit 识别图片中的物体
- 返回识别结果列表（按置信度排序）
- 提供中英文映射（识别结果转换为中文类别和关键词）

#### 2. ProductRecommendationService
- 根据识别结果推荐商品
- 计算商品匹配分数
- 返回推荐商品列表

#### 3. CameraScreen
- 相机预览界面
- 拍照功能
- 权限处理

#### 4. RecognitionResultScreen
- 识别结果展示
- 推荐商品列表
- 商品详情跳转

### 识别类别映射

系统支持以下物体的识别和类别映射：

| 识别结果（英文） | 中文关键词 | 商品类别 |
|----------------|----------|---------|
| headphone/earphone | 耳机 | 电子产品 |
| laptop/computer | 笔记本电脑/电脑 | 电子产品 |
| phone/smartphone | 手机 | 电子产品 |
| book/books | 书籍 | 图书文具 |
| clothing/clothes | 服装/衣服 | 服装配饰 |
| furniture | 家具 | 家具家电 |
| bicycle/bike | 自行车 | 运动健身 |
| car/vehicle | 汽车 | 汽车用品 |

## 匹配算法

商品推荐使用以下评分机制：

1. **类别匹配**（40分）
   - 如果商品类别与识别类别匹配，得40分

2. **标题关键词匹配**（50分）
   - 如果商品标题包含识别关键词，得50分
   - 多个关键词平均分配分数

3. **描述匹配**（10分）
   - 如果商品描述包含识别关键词，得10分

4. **置信度加权**
   - 如果识别置信度 > 70%，总分乘以1.2

最终返回匹配分数最高的前10个商品。

## 权限要求

- **CAMERA**: 相机权限（必需）
- 首次使用时会自动请求权限

## 注意事项

1. **识别准确性**：ML Kit 的识别准确性取决于：
   - 图片清晰度
   - 物体是否在画面中央
   - 光线条件

2. **网络要求**：
   - **当前实现**：使用设备端模型（On-device model），完全在设备上运行，**无需网络连接**
   - **工作原理**：ML Kit 的设备端模型已经打包在应用中，识别过程完全在本地设备上进行
   - **优势**：
     - 快速响应（无需网络延迟）
     - 保护隐私（图片不上传到服务器）
     - 节省流量
     - 离线可用
   - **局限性**：
     - 只能识别常见的物体类别（如"耳机"、"电脑"），无法识别具体品牌、型号
     - 准确性相对较低
   - **淘宝等商业应用的区别**：
     - 淘宝使用**云端深度学习模型**，需要将图片上传到服务器
     - 服务器使用更强大的模型，可以识别具体商品（品牌、型号、价格等）
     - 准确性更高，但需要网络连接和服务器资源
   - **可选升级方案**：如果需要更高准确性，可以：
     - 使用 ML Kit 的云端模型（需要 Google Cloud 配置）
     - 集成第三方商品识别 API（如阿里云、腾讯云等）
     - 自建商品识别服务

3. **性能优化**：
   - 图片会自动压缩处理
   - 识别过程在后台线程执行
   - 推荐算法优化，只返回前10个结果

4. **扩展性**：
   - 可以轻松添加新的识别类别映射
   - 可以调整匹配算法权重
   - 可以添加更多识别结果处理逻辑

## 设备端 vs 云端识别对比

| 特性 | 设备端模型（当前实现） | 云端模型（如淘宝） |
|------|---------------------|------------------|
| **网络要求** | 无需网络 | 需要网络连接 |
| **响应速度** | 快速（本地处理） | 较慢（需要上传和下载） |
| **隐私保护** | 图片不上传 | 图片上传到服务器 |
| **准确性** | 中等（识别常见物体） | 高（识别具体商品） |
| **识别范围** | 常见物体类别 | 具体商品、品牌、型号 |
| **成本** | 免费 | 需要服务器资源 |
| **离线支持** | ✅ 支持 | ❌ 不支持 |

## 为什么淘宝需要网络连接？

淘宝等商业应用使用**云端深度学习模型**的原因：

1. **识别精度要求高**：
   - 需要识别具体商品（如"AirPods Pro 2"而不是"耳机"）
   - 需要识别品牌、型号、价格等信息
   - 设备端模型无法达到这种精度

2. **商品数据库匹配**：
   - 识别后需要与商品数据库匹配
   - 推荐相似商品
   - 这些操作需要服务器资源

3. **持续优化**：
   - 云端模型可以持续训练和更新
   - 设备端模型更新需要应用更新

4. **商业需求**：
   - 需要收集用户行为数据
   - 需要分析用户偏好
   - 需要个性化推荐

## 未来优化方向

1. **支持从相册选择图片识别**
2. **添加识别历史记录**
3. **支持批量识别多个物体**
4. **添加识别结果分享功能**
5. **升级到云端模型**（可选）：
   - 使用 ML Kit 云端模型
   - 集成第三方商品识别 API（阿里云、腾讯云等）
   - 自建商品识别服务
6. **支持实时识别**（视频流识别）
7. **添加商品数据库匹配**（识别后直接匹配平台商品）

