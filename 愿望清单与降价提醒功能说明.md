# 愿望清单与降价提醒功能

## 功能简介

实现了完整的愿望清单与降价提醒功能，用户可以收藏感兴趣的商品，设置目标价格，当商品价格降至目标价格时会收到通知提醒。

## 核心功能

### 1. 愿望清单管理
- **添加愿望**：用户可以添加想买的商品
  - 商品名称（必填）
  - 商品类别（可选，可点击选择）
  - 价格区间（可选：最低价格、最高价格）
  - 目标价格（降价提醒，可选）
  - 详细描述（可选）

- **从商品详情页添加**：可以直接将商品加入愿望清单
  - 自动填充商品信息
  - 可以设置目标价格
  - 启用降价提醒

- **管理愿望清单**：查看、删除已添加的愿望

### 2. 降价提醒功能
- **目标价格设置**：用户可以设置期望的价格
- **自动检测**：系统会定期检查商品价格变化
- **智能匹配**：
  - 如果有关联的商品ID，直接检查该商品价格
  - 如果没有关联商品ID，根据标题、类别、价格区间匹配商品
- **通知提醒**：当商品价格降至目标价格时，发送通知

### 3. 通知系统
- **Android通知**：使用系统通知渠道
- **通知内容**：
  - 标题：商品降价提醒
  - 内容：商品名称和当前价格
  - 详细内容：显示目标价格对比
  - 点击通知：跳转到商品详情页

## 使用流程

### 1. 添加愿望清单（手动）
1. 在商品列表页点击"愿望清单"按钮
2. 点击"添加愿望"
3. 填写商品信息
4. 开启"降价提醒"开关
5. 设置目标价格
6. 保存

### 2. 从商品详情页添加
1. 在商品详情页点击"加入愿望清单"按钮
2. 系统自动填充商品信息
3. 设置目标价格（默认启用降价提醒）
4. 保存

### 3. 查看降价提醒状态
- 在愿望清单页面，启用降价提醒的商品会显示目标价格标签
- 标签显示："降价提醒: 目标价格 ¥XX.XX"

### 4. 接收提醒
- 当商品价格降至目标价格时，会收到系统通知
- 点击通知可以查看商品详情

## 数据库结构

### 愿望清单表（wishlist）
新增字段：
- `target_price`: 目标价格（0表示不启用）
- `item_id`: 关联的商品ID（如果是从商品详情页添加的）
- `enable_price_alert`: 是否启用降价提醒

## 技术实现

### 数据层
- `WishlistItem`: 扩展了降价提醒相关字段
- `WishlistEntity`: Room数据库实体，添加新字段
- `PriceAlertService`: 价格提醒服务
  - 创建通知渠道
  - 检查价格变化
  - 发送通知

### UI层
- `AddWishScreen`: 添加降价提醒设置UI
- `AddItemToWishlistScreen`: 从商品详情页添加愿望清单
- `WishlistScreen`: 显示降价提醒状态
- `ItemDetailScreen`: 添加"加入愿望清单"按钮

### 价格检测
- 应用启动时自动检查一次
- 可以手动触发检查（通过ViewModel）
- 支持两种匹配模式：
  - 精确匹配（有关联商品ID）
  - 模糊匹配（根据条件查找）

## 通知权限

应用需要通知权限（Android 13+）：
- 已在 AndroidManifest.xml 中添加 `POST_NOTIFICATIONS` 权限
- 首次使用时会请求权限

## 注意事项

1. **数据库版本**：已升级到版本7，会自动重建数据库（开发阶段）
2. **通知渠道**：创建了"价格提醒"通知渠道
3. **价格检查**：目前是应用启动时检查，可以扩展为定期检查
4. **匹配逻辑**：如果没有关联商品ID，会根据标题、类别、价格区间匹配

## 未来优化方向

1. 添加定期检查机制（使用WorkManager）
2. 支持价格变化历史记录
3. 添加多个目标价格（不同价格点提醒）
4. 支持价格趋势预测
5. 添加邮件提醒（可选）



